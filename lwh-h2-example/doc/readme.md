# h2 数据库

h2是一个开源的纯java编写的轻量级数据库，是一个用Java开发的嵌入式数据库，只有一个jar文件，可以直接嵌入到应用项目中。

h2最大的用途在于可以同应用程序打包在一起发布，这样可以非常方便地存储少量结构化数据，
它的另一个用途是用于单元测试。启动速度快，而且可以关闭持久化功能，每一个用例执行完随
即还原到初始状态。

h2的第三个用处是作为缓存，作为NoSQL的一个补充。
    官方网址：http://www.h2database.com
        CSDN的使用参考例子：http://blog.csdn.net/qq_25033135/article/details/44921587
        
        
与h2一样作为开源的数据库还有Derby、HSQLDB、MySQL、PostgreSQL、SQLite等。其中h2和HSQLDB类似，十分适合作为嵌入式
数据库使用，其它的数据库大部分都需要安装独立的客户端和服务器端。所谓嵌入式数据库，就是直接在项目中引入h2的jar包，
通过java代码启动h2的服务，项目即可使用h2的数据库功能，而不需要额外的安装h2服务器。故h2非常适合作为桌面软件的嵌入式数
据库，用户只需要安装和运行桌面软件即可，而无须额外处理数据库的服务问题。

h2的数据库服务，可通过安装服务端软件（windows和linux均支持）来提供数据库服务，单也可以直接通过h2.jar包直接通过
java代码创建服务，从而提供相应的数据库服务。通常使用h2.jar包形式来提供服务，一般都是便于用作嵌入式数据库服务时使
用。如果作为普通的数据库服务，通常都是安装服务端软件。


h2支持多种服务模式，在启动的时候就需要指定服务模式，并且不同模式下客户端的url连接会有区别。h2数据库总体来说分为两类：
+ (1)嵌入模式(本地连接方式)：

这种连接方式默认情况下只允许有一个客户端连接到H2数据库，有客户端连接到H2数据库之后，此时数据库文件就会被锁定，那么其
他客户端就无法再连接了。使用嵌入模式，不需要先启动h2的服务器，直接执行客户端即可。

jdbc的url连接格式：
`jdbc:h2:[file:][<path>]<databaseName>`
例如：
```
　　　　jdbc:h2:~/test //连接位于当前系统用户目录下的test数据库(如果数据库不存在会自动创建)
　　　　jdbc:h2:file:/data/sample //连接/data目录下的sample数据库(如果数据库不存在会自动创建)
　　　　jdbc:h2:file:E:/H2/gacl   //连接E:/H2目录下的gacl数据库(如果数据库不存在会自动创建)
```
+ (2)服务器模式(远程连接方式)：

这种连接方式就和其他数据库类似了，是基于Service的形式进行连接的，因此允许多个客户端同时连接到H2数据库。
使用服务器模式，必须先启动h2的服务器，客户端才能连接并执行sql脚本。

jdbc的url连接格式(TCP连接)：
`jdbc:h2:tcp://<server>[:<port>]/[<path>]<databaseName>`
例如：
```
jdbc:h2:tcp://localhost/~/test
```

补充说明：

如果再细分h2的连接模式，还可以分析内存模式，TCL服务器模式，SSL服务器模式，混合模式等。
具体参考图片 h2不同模式的url连接.png

**如果项目中使用h2数据库的嵌入模式，并且可能会在多线程中操作h2数据库，那么建议将嵌入模式改为混合模式**，即基于嵌入模式
的基础上，允许多个客户端进行连接，而不是针对单一客户端连接而进行数据库文件加锁，这样可以在多线程操作数据库的情况下增加
性能。混动模式的使用，只需修改客户端的url地址。

格式为：
`jdbc:h2:[file:][<path>]<databaseName>;AUTO_SERVER=TRUE`
例如：
```
jdbc:h2:~/test;AUTO_SERVER=TRUE
```

h2.jar不但拥有数据库服务端的功能，而且还提供了一个web版本的客户端，此客户端不仅支持h2，还支持Derby、MySQL、Oracle、HSQLDB
等数据库连接，但是需要额外引入其他数据库的jdbc规范的jar包才可以使用。


**特别说明：** h2的web客户端是在连接数据库后，使用的是connection对象的连接池，如果是嵌入式模式，则连接池只有一个connection对象。
当打开多个web页面来操作数据库的时候，其实使用的都是同一个connection对象，而不是一个web页面就一个连接对象。


h2存储数据的数据库目录下，会有两个db文件，例如数据库名叫myh2db，则会有myh2db.mv.db和myh2db.trace.db文件，其中myh2db.mv.db
存储的是数据库的数据，myh2db.trace.db文件存储的是操作日志（包括错误信息），通过myh2db.trace.文件操作日志可以非常方便的查看数
据库的操作情况。

h2数据库默认有个INFORMATION_SCHEMA约束，此约束下面有一序列的系统表，例如用户表、帮助表等，可以根据需要查询此约束下的表，查询时
需要带上INFORMATION_SCHEMA.表名来可以查询。例如：SELECT * FROM INFORMATION_SCHEMA.HELP;
